import sqlite3

class Transaction:
    def __init__(self):
        self.transaction_data = []
        self.discount = 0

    def add_item(self, item_name, item_qty, item_price):
        item_total_price = item_qty * item_price
        self.transaction_data.append([item_name, item_qty, item_price, item_total_price])

    def update_item_name(self, old_name, new_name):
        for item in self.transaction_data:
            if item[0] == old_name:
                item[0] = new_name

    def update_item_qty(self, item_name, new_qty):
        for item in self.transaction_data:
            if item[0] == item_name:
                item[1] = new_qty
                item[3] = new_qty * item[2]

    def update_item_price(self, item_name, new_price):
        for item in self.transaction_data:
            if item[0] == item_name:
                item[2] = new_price
                item[3] = item[1] * new_price

    def delete_item(self, item_name):
        self.transaction_data = [item for item in self.transaction_data if item[0] != item_name]

    def reset_transaction(self):
        self.transaction_data = []

    def check_order(self):
        if all(all(item) for item in self.transaction_data):
            return "Pemesanan sudah benar"
        else:
            return "Terdapat kesalahan input data"

    def check_out(self):
        if not self.transaction_data:
            return "Tidak ada transaksi untuk check-out"

        total_price = sum(item[3] for item in self.transaction_data)
        self.calculate_discount(total_price)

        print("| No | Nama Item | Jumlah Item | Harga/Item | Total Harga |")
        print("|----|-----------|-------------|------------|-------------|")
        for i, item in enumerate(self.transaction_data, start=1):
            print(f"| {i}  | {item[0]}  | {item[1]}           | {item[2]}      | {item[3]}      |")

        print(f"\nTotal Harga = Rp{total_price}")
        print(f"Diskon {self.discount * 100}% = Rp{total_price * self.discount}")
        print(f"Total Pembayaran = Rp{total_price - (total_price * self.discount)}")

      

    def calculate_discount(self, total_price):
        if total_price > 500000:
            self.discount = 0.07
        elif total_price > 300000:
            self.discount = 0.06
        elif total_price > 200000:
            self.discount = 0.05

    def insert_to_table(self, source_data):
        conn = sqlite3.connect('supermarket.db')
        cursor = conn.cursor()

        for item in source_data:
            nama_item, jumlah_item, harga, total_harga = item
            diskon = self.discount * 100
            harga_diskon = harga - (harga * self.discount)
          

        conn.commit()
        conn.close()


# Inisialisasi transaksi
trnsct_123 = Transaction()
